<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Seating Canvas</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .canvas-container {
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            cursor: crosshair;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn:hover { opacity: 0.8; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: bold;
        }
        .stat-available { background: #28a745; }
        .stat-occupied { background: #dc3545; }
        .stat-reserved { background: #ffc107; color: black; }
        .stat-disabled { background: #6c757d; }
        .legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .template-card {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .template-card:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        .template-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .template-card p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        .selected-seat {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .seat-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .seat-info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .seat-info-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ Test S∆° ƒë·ªì gh·∫ø Canvas</h1>
        <p>Demo h·ªá th·ªëng v·∫Ω s∆° ƒë·ªì gh·∫ø tr·ª±c quan v√† d·ªÖ s·ª≠ d·ª•ng</p>

        <!-- Template Selection -->
        <div class="controls">
            <h3>üìã Ch·ªçn m·∫´u layout:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('theater')">
                    <h3>üé≠ Nh√† h√°t</h3>
                    <p>Layout gh·∫ø nh√† h√°t truy·ªÅn th·ªëng<br>15 h√†ng x 20 gh·∫ø</p>
                </div>
                <div class="template-card" onclick="loadTemplate('concert')">
                    <h3>üéµ S√¢n kh·∫•u nh·∫°c</h3>
                    <p>Layout gh·∫ø s√¢n kh·∫•u nh·∫°c<br>20 h√†ng x 25 gh·∫ø</p>
                </div>
                <div class="template-card" onclick="loadTemplate('conference')">
                    <h3>üè¢ H·ªôi tr∆∞·ªùng</h3>
                    <p>Layout gh·∫ø h·ªôi tr∆∞·ªùng<br>12 h√†ng x 30 gh·∫ø</p>
                </div>
                <div class="template-card" onclick="loadTemplate('cinema')">
                    <h3>üé¨ R·∫°p chi·∫øu phim</h3>
                    <p>Layout gh·∫ø r·∫°p chi·∫øu phim<br>18 h√†ng x 22 gh·∫ø</p>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <h3>üéõÔ∏è ƒêi·ªÅu khi·ªÉn:</h3>
            <div class="control-group">
                <button class="btn-primary" onclick="toggleEditMode()">‚úèÔ∏è V·∫Ω gh·∫ø</button>
                <button class="btn-success" onclick="toggleGrid()">üìê L∆∞·ªõi</button>
                <button class="btn-warning" onclick="toggleLabels()">üè∑Ô∏è Nh√£n</button>
                <button class="btn-danger" onclick="clearSeats()">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
                <button class="btn-secondary" onclick="exportSeats()">üì§ Xu·∫•t JSON</button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats">
            <div class="stat-card stat-available">
                <div id="available-count">0</div>
                <div>C√≥ s·∫µn</div>
            </div>
            <div class="stat-card stat-occupied">
                <div id="occupied-count">0</div>
                <div>ƒê√£ ƒë·∫∑t</div>
            </div>
            <div class="stat-card stat-reserved">
                <div id="reserved-count">0</div>
                <div>ƒê√£ gi·ªØ</div>
            </div>
            <div class="stat-card stat-disabled">
                <div id="disabled-count">0</div>
                <div>V√¥ hi·ªáu</div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #4CAF50;"></div>
                <span>C√≥ s·∫µn</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #F44336;"></div>
                <span>ƒê√£ ƒë·∫∑t</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FF9800;"></div>
                <span>ƒê√£ gi·ªØ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9E9E9E;"></div>
                <span>V√¥ hi·ªáu</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFD700;"></div>
                <span>VIP</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2196F3;"></div>
                <span>Premium</span>
            </div>
        </div>

        <!-- Canvas -->
        <div class="canvas-container">
            <canvas id="seatingCanvas" width="800" height="600"></canvas>
        </div>

        <!-- Selected Seat Info -->
        <div id="selectedSeatInfo" class="selected-seat" style="display: none;">
            <h3>üéØ Gh·∫ø ƒë∆∞·ª£c ch·ªçn:</h3>
            <div class="seat-info" id="seatInfo">
                <!-- Seat info will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Canvas setup
        const canvas = document.getElementById('seatingCanvas');
        const ctx = canvas.getContext('2d');
        
        // State
        let seats = [];
        let isEditMode = false;
        let showGrid = true;
        let showLabels = true;
        let selectedSeat = null;
        let isDrawing = false;
        let dragStart = null;

        // Constants
        const seatSize = 30;
        const seatSpacing = 5;
        const rowSpacing = 40;
        const seatColors = {
            available: '#4CAF50',
            occupied: '#F44336',
            reserved: '#FF9800',
            disabled: '#9E9E9E'
        };

        // Initialize
        initCanvas();

        function initCanvas() {
            drawCanvas();
            setupEventListeners();
        }

        function setupEventListeners() {
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseLeave);
        }

        function drawCanvas() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            if (showGrid) {
                drawGrid();
            }

            // Draw seats
            drawSeats();

            // Draw stage
            drawStage();
        }

        function drawGrid() {
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;

            // Vertical lines
            for (let x = 0; x <= canvas.width; x += seatSize + seatSpacing) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            // Horizontal lines
            for (let y = 0; y <= canvas.height; y += rowSpacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function drawStage() {
            const stageWidth = canvas.width * 0.8;
            const stageHeight = 60;
            const stageX = (canvas.width - stageWidth) / 2;
            const stageY = canvas.height - stageHeight - 20;

            // Stage background
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(stageX, stageY, stageWidth, stageHeight);

            // Stage border
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 2;
            ctx.strokeRect(stageX, stageY, stageWidth, stageHeight);

            // Stage text
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('S√ÇN KH·∫§U', canvas.width / 2, stageY + stageHeight / 2 + 5);
        }

        function drawSeats() {
            seats.forEach(seat => {
                const isSelected = selectedSeat?.id === seat.id;
                
                // Seat background
                ctx.fillStyle = seat.color || seatColors[seat.status];
                ctx.fillRect(seat.x, seat.y, seat.width, seat.height);

                // Seat border
                ctx.strokeStyle = isSelected ? '#2196F3' : '#333';
                ctx.lineWidth = isSelected ? 3 : 1;
                ctx.strokeRect(seat.x, seat.y, seat.width, seat.height);

                // Seat label
                if (showLabels) {
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(
                        `${seat.row}${String.fromCharCode(65 + seat.column)}`,
                        seat.x + seat.width / 2,
                        seat.y + seat.height / 2 + 4
                    );
                }

                // Price label
                if (seat.price && showLabels) {
                    ctx.fillStyle = '#333';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(
                        `${seat.price.toLocaleString()}ƒë`,
                        seat.x + seat.width / 2,
                        seat.y + seat.height + 12
                    );
                }
            });
        }

        function getSeatAtPosition(x, y) {
            return seats.find(seat => 
                x >= seat.x && x <= seat.x + seat.width &&
                y >= seat.y && y <= seat.y + seat.height
            ) || null;
        }

        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (isEditMode) {
                // Drawing mode
                isDrawing = true;
                dragStart = { x, y };
            } else {
                // Selection mode
                const seat = getSeatAtPosition(x, y);
                selectedSeat = seat;
                updateSelectedSeatInfo();
                drawCanvas();
            }
        }

        function handleMouseMove(e) {
            if (!isDrawing || !dragStart || !isEditMode) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Create new seat
            const newSeat = {
                id: `seat_${Date.now()}`,
                row: Math.floor(y / rowSpacing) + 1,
                column: Math.floor(x / (seatSize + seatSpacing)) + 1,
                x: Math.floor(x / (seatSize + seatSpacing)) * (seatSize + seatSpacing),
                y: Math.floor(y / rowSpacing) * rowSpacing,
                width: seatSize,
                height: seatSize,
                status: 'available',
                color: seatColors.available,
                price: 200000
            };

            // Check if seat already exists
            const existingSeat = seats.find(seat => 
                seat.row === newSeat.row && seat.column === newSeat.column
            );

            if (!existingSeat) {
                seats.push(newSeat);
                updateStats();
                drawCanvas();
            }
        }

        function handleMouseUp() {
            isDrawing = false;
            dragStart = null;
        }

        function handleMouseLeave() {
            isDrawing = false;
            dragStart = null;
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            canvas.style.cursor = isEditMode ? 'crosshair' : 'pointer';
            const btn = event.target;
            btn.textContent = isEditMode ? 'üñ±Ô∏è T·∫Øt v·∫Ω' : '‚úèÔ∏è V·∫Ω gh·∫ø';
            btn.className = isEditMode ? 'btn-danger' : 'btn-primary';
        }

        function toggleGrid() {
            showGrid = !showGrid;
            drawCanvas();
            const btn = event.target;
            btn.textContent = showGrid ? 'üìê ·∫®n l∆∞·ªõi' : 'üìê Hi·ªán l∆∞·ªõi';
        }

        function toggleLabels() {
            showLabels = !showLabels;
            drawCanvas();
            const btn = event.target;
            btn.textContent = showLabels ? 'üè∑Ô∏è ·∫®n nh√£n' : 'üè∑Ô∏è Hi·ªán nh√£n';
        }

        function clearSeats() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ gh·∫ø?')) {
                seats = [];
                selectedSeat = null;
                updateStats();
                updateSelectedSeatInfo();
                drawCanvas();
            }
        }

        function updateStats() {
            const stats = {
                available: seats.filter(s => s.status === 'available').length,
                occupied: seats.filter(s => s.status === 'occupied').length,
                reserved: seats.filter(s => s.status === 'reserved').length,
                disabled: seats.filter(s => s.status === 'disabled').length
            };

            document.getElementById('available-count').textContent = stats.available;
            document.getElementById('occupied-count').textContent = stats.occupied;
            document.getElementById('reserved-count').textContent = stats.reserved;
            document.getElementById('disabled-count').textContent = stats.disabled;
        }

        function updateSelectedSeatInfo() {
            const infoDiv = document.getElementById('selectedSeatInfo');
            const seatInfoDiv = document.getElementById('seatInfo');

            if (selectedSeat) {
                infoDiv.style.display = 'block';
                seatInfoDiv.innerHTML = `
                    <div class="seat-info-item">
                        <span>V·ªã tr√≠:</span>
                        <span>${selectedSeat.row}${String.fromCharCode(65 + selectedSeat.column)}</span>
                    </div>
                    <div class="seat-info-item">
                        <span>Tr·∫°ng th√°i:</span>
                        <span>${getStatusText(selectedSeat.status)}</span>
                    </div>
                    <div class="seat-info-item">
                        <span>Gi√°:</span>
                        <span>${selectedSeat.price ? selectedSeat.price.toLocaleString() + 'ƒë' : 'N/A'}</span>
                    </div>
                    <div class="seat-info-item">
                        <span>Lo·∫°i:</span>
                        <span>${selectedSeat.category || 'Th∆∞·ªùng'}</span>
                    </div>
                `;
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'available': 'C√≥ s·∫µn',
                'occupied': 'ƒê√£ ƒë·∫∑t',
                'reserved': 'ƒê√£ gi·ªØ',
                'disabled': 'V√¥ hi·ªáu'
            };
            return statusMap[status] || status;
        }

        function exportSeats() {
            const dataStr = JSON.stringify(seats, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'seats_export.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Template functions
        function loadTemplate(type) {
            seats = generateTemplateSeats(type);
            updateStats();
            drawCanvas();
        }

        function generateTemplateSeats(type) {
            const templates = {
                theater: {
                    rows: 15,
                    seatsPerRow: 20,
                    seatSize: 30,
                    seatSpacing: 5,
                    rowSpacing: 40
                },
                concert: {
                    rows: 20,
                    seatsPerRow: 25,
                    seatSize: 25,
                    seatSpacing: 3,
                    rowSpacing: 35
                },
                conference: {
                    rows: 12,
                    seatsPerRow: 30,
                    seatSize: 28,
                    seatSpacing: 4,
                    rowSpacing: 38
                },
                cinema: {
                    rows: 18,
                    seatsPerRow: 22,
                    seatSize: 32,
                    seatSpacing: 6,
                    rowSpacing: 42
                }
            };

            const config = templates[type];
            const seats = [];

            for (let row = 1; row <= config.rows; row++) {
                for (let col = 1; col <= config.seatsPerRow; col++) {
                    const x = (col - 1) * (config.seatSize + config.seatSpacing);
                    const y = (row - 1) * config.rowSpacing;

                    let price = 200000;
                    let color = seatColors.available;
                    let category = 'Th∆∞·ªùng';

                    // Different pricing for different templates
                    if (type === 'theater') {
                        if (row <= 3) {
                            price = 500000;
                            color = '#FFD700';
                            category = 'VIP';
                        }
                    } else if (type === 'concert') {
                        if (row <= 5) {
                            price = 800000;
                            color = '#FFD700';
                            category = 'VIP';
                        } else if (row <= 10) {
                            price = 500000;
                            color = '#2196F3';
                            category = 'Premium';
                        }
                    } else if (type === 'cinema') {
                        if (row <= 4) {
                            price = 200000;
                            color = '#FFD700';
                            category = 'VIP';
                        } else if (row <= 8) {
                            price = 150000;
                            color = '#2196F3';
                            category = 'Premium';
                        } else {
                            price = 120000;
                        }
                    }

                    seats.push({
                        id: `seat_${row}_${col}`,
                        row,
                        column: col,
                        x,
                        y,
                        width: config.seatSize,
                        height: config.seatSize,
                        status: 'available',
                        price,
                        category,
                        color
                    });
                }
            }

            return seats;
        }

        // Initialize with theater template
        loadTemplate('theater');
    </script>
</body>
</html> 