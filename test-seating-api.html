<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Seating API</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">üß™ Test Seating API</h1>
        
        <!-- Login Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">üîê ƒêƒÉng nh·∫≠p</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email:</label>
                    <input type="email" id="email" value="admin@longhai.com" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password:</label>
                    <input type="password" id="password" value="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <button onclick="login()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">ƒêƒÉng nh·∫≠p</button>
            <div id="loginResult" class="mt-4 p-3 rounded-md hidden"></div>
        </div>

        <!-- API Tests -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Events API -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üìÖ Events API</h2>
                <button onclick="testEvents()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 mb-4">Test /api/events</button>
                <div id="eventsResult" class="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-auto max-h-64"></div>
            </div>

            <!-- Ticket Types API -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üé´ Ticket Types API</h2>
                <button onclick="testTicketTypes()" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 mb-4">Test /api/tickets/types</button>
                <div id="ticketTypesResult" class="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-auto max-h-64"></div>
            </div>

            <!-- Seats API -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">ü™ë Seats API</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Event ID:</label>
                    <input type="text" id="eventId" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="space-y-2">
                    <button onclick="testGetSeats()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Get Seats</button>
                    <button onclick="testSaveSeats()" class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Save Seats</button>
                </div>
                <div id="seatsResult" class="mt-4 bg-gray-100 p-4 rounded-md text-sm font-mono overflow-auto max-h-64"></div>
            </div>

            <!-- User Profile -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">üë§ User Profile</h2>
                <button onclick="testUserProfile()" class="px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 mb-4">Test /api/user</button>
                <div id="userResult" class="bg-gray-100 p-4 rounded-md text-sm font-mono overflow-auto max-h-64"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        let token = localStorage.getItem('access_token');

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.className = `bg-gray-100 p-4 rounded-md text-sm font-mono overflow-auto max-h-64 ${isError ? 'border-l-4 border-red-500' : ''}`;
            element.textContent = JSON.stringify(data, null, 2);
            element.classList.remove('hidden');
        }

        async function apiCall(endpoint, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                ...options.headers
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const response = await fetch(`${API_BASE}${endpoint}`, {
                ...options,
                headers
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || 'API call failed');
            }

            return data;
        }

        async function login() {
            try {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const data = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),
                });

                const result = await data.json();

                if (data.ok) {
                    token = result.access_token;
                    localStorage.setItem('access_token', token);
                    localStorage.setItem('user', JSON.stringify(result.user));
                    showResult('loginResult', { success: true, message: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng', user: result.user });
                } else {
                    showResult('loginResult', { success: false, message: result.message }, true);
                }
            } catch (error) {
                showResult('loginResult', { success: false, message: error.message }, true);
            }
        }

        async function testEvents() {
            try {
                const data = await apiCall('/events');
                showResult('eventsResult', data);
            } catch (error) {
                showResult('eventsResult', { error: error.message }, true);
            }
        }

        async function testTicketTypes() {
            try {
                const data = await apiCall('/tickets/types');
                showResult('ticketTypesResult', data);
            } catch (error) {
                showResult('ticketTypesResult', { error: error.message }, true);
            }
        }

        async function testGetSeats() {
            try {
                const eventId = document.getElementById('eventId').value;
                const data = await apiCall(`/seats/${eventId}`);
                showResult('seatsResult', data);
            } catch (error) {
                showResult('seatsResult', { error: error.message }, true);
            }
        }

        async function testSaveSeats() {
            try {
                const eventId = document.getElementById('eventId').value;
                const sampleSeats = [
                    {
                        id: 'seat_1',
                        row: 1,
                        column: 1,
                        x: 50,
                        y: 50,
                        width: 35,
                        height: 35,
                        status: 'available',
                        price: 200000,
                        category: 'Standard',
                        color: '#4CAF50',
                        ticketType: 'standard',
                        seatName: 'A1',
                        rowName: 'H√†ng A'
                    }
                ];

                const data = await apiCall(`/seats/${eventId}`, {
                    method: 'POST',
                    body: JSON.stringify({ seats: sampleSeats })
                });
                showResult('seatsResult', data);
            } catch (error) {
                showResult('seatsResult', { error: error.message }, true);
            }
        }

        async function testUserProfile() {
            try {
                const data = await apiCall('/user');
                showResult('userResult', data);
            } catch (error) {
                showResult('userResult', { error: error.message }, true);
            }
        }

        // Auto-login if token exists
        if (token) {
            document.getElementById('loginResult').textContent = 'Token found, ready to test APIs';
            document.getElementById('loginResult').classList.remove('hidden');
        }
    </script>
</body>
</html> 